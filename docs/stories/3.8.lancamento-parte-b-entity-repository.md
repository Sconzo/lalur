# Story 3.8: Entidade LancamentoParteB (Lançamento da Parte B) e Repository

**Como** desenvolvedor,
**Eu quero** entidade LancamentoParteB relacionada a Company, ChartOfAccount, ContaParteB e TaxParameter,
**Para que** possamos persistir lançamentos de ajustes fiscais (adições/exclusões) na Parte B com vinculação flexível a contas contábeis e/ou contas Parte B.

## Acceptance Criteria

1. Entidade JPA `LancamentoParteBEntity` criada estendendo `BaseEntity`:
   - `@ManyToOne @JoinColumn(nullable=false) CompanyEntity company`
   - `@Column(nullable=false) Integer mesReferencia` (mês de referência 1-12)
   - `@Column(nullable=false) Integer anoReferencia` (ano de referência)
   - `@Enumerated(STRING) TipoApuracao tipoApuracao` (IRPJ, CSLL)
   - `@Enumerated(STRING) TipoRelacionamento tipoRelacionamento` (CONTA_CONTABIL, CONTA_PARTE_B, AMBOS)
   - `@ManyToOne @JoinColumn(name="conta_contabil_id") ChartOfAccountEntity contaContabil` (nullable)
   - `@ManyToOne @JoinColumn(name="conta_parte_b_id") ContaParteBEntity contaParteB` (nullable)
   - `@ManyToOne @JoinColumn(nullable=false) TaxParameterEntity parametroTributario` (FK obrigatória)
   - `@Enumerated(STRING) TipoAjuste tipoAjuste` (ADICAO, EXCLUSAO)
   - `@Column(nullable=false, length=2000) String descricao` (descrição do ajuste)
   - `@Column(nullable=false, precision=19, scale=2) BigDecimal valor` (valor sempre positivo)
2. Enums criados:
   - `TipoApuracao`: IRPJ, CSLL
   - `TipoRelacionamento`: CONTA_CONTABIL, CONTA_PARTE_B, AMBOS
   - `TipoAjuste`: ADICAO, EXCLUSAO
3. Check constraints (validação via JPA @PrePersist e @PreUpdate):
   - Se tipoRelacionamento = CONTA_CONTABIL: contaContabil NOT NULL e contaParteB NULL
   - Se tipoRelacionamento = CONTA_PARTE_B: contaParteB NOT NULL e contaContabil NULL
   - Se tipoRelacionamento = AMBOS: contaContabil NOT NULL e contaParteB NOT NULL
   - valor > 0
4. Interface `LancamentoParteBRepositoryPort` criada com métodos save, findById, findByCompanyIdAndAnoReferencia, etc.
5. Interface `LancamentoParteBJpaRepository` criada estendendo `JpaRepository<LancamentoParteBEntity, Long>`
6. Classe `LancamentoParteBRepositoryAdapter` implementa `LancamentoParteBRepositoryPort`
7. Model `LancamentoParteB` (domain) criado como POJO puro
8. Mapper MapStruct `LancamentoParteBMapper` criado
9. Validação customizada `@LancamentoParteBValidator` annotation para validar regras condicionais de FK
10. Teste de integração valida todos cenários de tipoRelacionamento e validações de FK condicionais

## Technical Notes

- **Validação condicional complexa**: FKs opcionais dependem do tipoRelacionamento
- **Fundamentação obrigatória**: Cada ajuste fiscal deve ter parâmetro tributário associado
- **Tipo apuração separado**: Permite apurações IRPJ e CSLL independentes

## Definition of Done

- [ ] Entidade JPA criada com todos campos e enums
- [ ] Validação condicional implementada
- [ ] Repository port e adapter
- [ ] Domain model e mapper
- [ ] Testes de integração passando
- [ ] Code review aprovado
- [ ] Merge em develop
