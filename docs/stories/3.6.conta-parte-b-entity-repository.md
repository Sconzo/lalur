# Story 3.6: Entidade ContaParteB (Conta da Parte B e-Lalur/e-Lacs) e Repository

**Como** desenvolvedor,
**Eu quero** entidade ContaParteB relacionada a Company com campos para e-Lalur/e-Lacs,
**Para que** possamos persistir Contas da Parte B específicas de IRPJ/CSLL com vigência temporal e saldo inicial.

## Acceptance Criteria

1. Entidade JPA `ContaParteBEntity` criada estendendo `BaseEntity`:
   - `@ManyToOne @JoinColumn(nullable=false) CompanyEntity company` (empresa dona do cadastro)
   - `@Column(nullable=false) String codigoConta` (código da conta Parte B, ex: "4.01.01")
   - `@Column(nullable=false, length=1000) String descricao` (descrição da conta)
   - `@Column(nullable=false) Integer anoBase` (ano base de criação/referência)
   - `@Column(nullable=false) LocalDate dataVigenciaInicio` (data início de vigência)
   - `@Column LocalDate dataVigenciaFim` (data fim de vigência - nullable, null = vigente)
   - `@Enumerated(STRING) TipoTributo tipoTributo` (IRPJ, CSLL, AMBOS)
   - `@Column(precision=19, scale=2) BigDecimal saldoInicial` (saldo inicial da conta)
   - `@Enumerated(STRING) TipoSaldo tipoSaldo` (DEVEDOR, CREDOR)
2. Enums criados:
   - `TipoTributo`: IRPJ, CSLL, AMBOS
   - `TipoSaldo`: DEVEDOR, CREDOR
3. Constraint de unicidade: `@Table(uniqueConstraints = @UniqueConstraint(columnNames = {"company_id", "codigo_conta", "ano_base"}))`
4. Interface `ContaParteBRepositoryPort` criada em `application/port/out/`:
   - `ContaParteB save(ContaParteB conta)`
   - `Optional<ContaParteB> findById(Long id)`
   - `List<ContaParteB> findByCompanyIdAndAnoBase(Long companyId, Integer anoBase)`
   - `Optional<ContaParteB> findByCompanyIdAndCodigoContaAndAnoBase(Long companyId, String codigoConta, Integer anoBase)`
   - `Page<ContaParteB> findByCompanyId(Long companyId, Pageable pageable)`
5. Interface `ContaParteBJpaRepository` criada estendendo `JpaRepository<ContaParteBEntity, Long>`:
   - `List<ContaParteBEntity> findByCompanyIdAndAnoBase(Long companyId, Integer anoBase)`
   - `Optional<ContaParteBEntity> findByCompanyIdAndCodigoContaAndAnoBase(Long companyId, String codigoConta, Integer anoBase)`
6. Classe `ContaParteBRepositoryAdapter` implementa `ContaParteBRepositoryPort`
7. Model `ContaParteB` (domain) criado em `domain/model/` como POJO puro
8. Mapper MapStruct `ContaParteBMapper` criado
9. Teste de integração valida:
   - Salvar conta Parte B com todos campos e recuperar por company + anoBase
   - Unique constraint funciona
   - Buscar conta por company + codigoConta + anoBase
   - Soft delete funciona
   - Listagem paginada por empresa
   - Campos tipoTributo e tipoSaldo são persistidos corretamente

## Technical Notes

- **Separação entre contas contábeis e fiscais**: ContaParteB não está no plano de contas contábil
- **Vigência temporal**: Contas podem ter período de validade (comum em legislação fiscal)
- **Tipo tributo flexível**: Conta pode ser específica de IRPJ, CSLL ou aplicável a ambos
- **Saldo inicial configurável**: Importante para carry-forward de exercícios anteriores
- **Versionamento anual**: anoBase permite estrutura diferente por ano fiscal

## Definition of Done

- [x] Entidade JPA criada com todos os campos
- [x] Enums TipoTributo e TipoSaldo criados
- [x] Repository port e adapter implementados
- [x] Domain model criado
- [x] Mapper MapStruct funcionando
- [x] Testes de integração passando (TestContainers)
- [ ] Code review aprovado
- [ ] Merge em develop

---

## Dev Agent Record

### Status
**Ready for Review** - Implementação completa, aguardando code review

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Completion Notes
- Enums TipoTributo (IRPJ, CSLL, AMBOS) e TipoSaldo (DEVEDOR, CREDOR) criados no domain
- Domain model ContaParteB com todos campos especificados (vigência temporal, saldo inicial, etc)
- Entidade JPA ContaParteBEntity com constraint unique (company_id, codigo_conta, ano_base)
- Repository Port e Adapter implementados com relacionamento Company
- Mapper MapStruct com mapeamento correto de company.id
- 10 testes de integração cobrindo todos AC (unique constraint, enums, vigência, paginação, soft delete)
- Build compilou com sucesso (0 violations do Checkstyle)
- Suppressão de warnings "AbbreviationAsWordInName" adicionada (termo "Parte B" é oficial do e-Lalur)

### File List

**Enums criados:**
- src/main/java/br/com/lalurecf/domain/enums/TipoTributo.java
- src/main/java/br/com/lalurecf/domain/enums/TipoSaldo.java

**Domain model criado:**
- src/main/java/br/com/lalurecf/domain/model/ContaParteB.java

**Entidade JPA criada:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/entity/ContaParteBEntity.java

**Repository Port criado:**
- src/main/java/br/com/lalurecf/application/port/out/ContaParteBRepositoryPort.java

**JPA Repository criado:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/repository/ContaParteBJpaRepository.java

**Mapper criado:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/mapper/ContaParteBMapper.java

**Adapter criado:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/adapter/ContaParteBRepositoryAdapter.java

**Testes criados:**
- src/test/java/br/com/lalurecf/infrastructure/adapter/out/persistence/adapter/ContaParteBRepositoryAdapterTest.java

### Change Log
- 2026-01-08: Story 3.6 implementada - Entidade ContaParteB e Repository com vigência temporal, enums TipoTributo/TipoSaldo, e relacionamento com Company
