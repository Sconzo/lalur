# Story 3.10: Entidade LancamentoContabil (Lançamento Contábil) e Repository

**Como** desenvolvedor,
**Eu quero** entidade LancamentoContabil com partidas dobradas,
**Para que** possamos persistir lançamentos contábeis com método débito/crédito e permitir CRUD completo.

## Acceptance Criteria

Ver Epic 3 Story 3.10 para critérios completos. Principais pontos:

1. **Entidade** com FK para contaDebito e contaCredito (partidas dobradas puras)
2. **Campos**: data, valor, historico, numeroDocumento, fiscalYear
3. **CHECK constraints**: valor > 0, contaDebito != contaCredito
4. **TemporalEntity** implementado para Período Contábil
5. **Validação customizada** `@LancamentoContabilValidator`

## Definition of Done

- [x] Entidade com partidas dobradas
- [x] Repository completo
- [x] Validações implementadas
- [x] Testes passando (8/8)
- [ ] Code review
- [ ] Merge em develop

**Referência detalhada**: docs/epics/epic-03-plano-contas-dados-contabeis.md - Story 3.10

---

## Dev Agent Record

### Status
**Ready for Review** - Implementação completa com validações de partidas dobradas e testes de integração (8/8 testes passando)

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Completion Notes
- Domain model `LancamentoContabil` criado implementando `TemporalEntity`
- Entity JPA `LancamentoContabilEntity` com validações @PrePersist/@PreUpdate:
  * Valor deve ser > 0
  * Conta de débito != conta de crédito
- Validação customizada `@LancamentoContabilValidator` criada (annotation + implementation)
- Repository port `LancamentoContabilRepositoryPort` criado
- JPA repository `LancamentoContabilJpaRepository` criado
- Mapper MapStruct `LancamentoContabilMapper` para conversão entity ↔ domain
- Adapter `LancamentoContabilRepositoryAdapter` com resolução de FKs (company, contaDebito, contaCredito)
- 8 testes de integração implementados cobrindo:
  * Salvar lançamento com partidas dobradas válidas
  * Validação: débito != crédito (throw InvalidDataAccessApiUsageException)
  * Validação: valor > 0 (throw InvalidDataAccessApiUsageException)
  * Busca por ID
  * Soft delete
  * Listagem por empresa e ano fiscal
  * Listagem paginada
- Build e testes executaram com sucesso (8/8 passando)

### File List

**Domain model:**
- src/main/java/br/com/lalurecf/domain/model/LancamentoContabil.java

**Entity JPA:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/entity/LancamentoContabilEntity.java

**Validação customizada:**
- src/main/java/br/com/lalurecf/infrastructure/validation/LancamentoContabilValidator.java
- src/main/java/br/com/lalurecf/infrastructure/validation/LancamentoContabilValidatorImpl.java

**Repository port:**
- src/main/java/br/com/lalurecf/application/port/out/LancamentoContabilRepositoryPort.java

**JPA repository:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/repository/LancamentoContabilJpaRepository.java

**Mapper:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/mapper/LancamentoContabilMapper.java

**Adapter:**
- src/main/java/br/com/lalurecf/infrastructure/adapter/out/persistence/adapter/LancamentoContabilRepositoryAdapter.java

**Testes:**
- src/test/java/br/com/lalurecf/infrastructure/adapter/out/persistence/adapter/LancamentoContabilRepositoryAdapterTest.java

### Change Log
- 2026-01-08: Story 3.10 implementada - Entidade LancamentoContabil e Repository com partidas dobradas (débito/crédito), validações automáticas, soft delete e 8 testes de integração
